syntax = "proto3";

package v1.issuer;

option go_package = "vc/internal/gen/issuer/apiv1_issuer";

//import "google/protobuf/timestamp.proto";
//import "google/protobuf/any.proto";

service IssuerService {
    rpc MakeSDJWT (MakeSDJWTRequest) returns (MakeSDJWTReply) {}
    rpc MakeMDoc (MakeMDocRequest) returns (MakeMDocReply) {}
    rpc MakeVC20 (MakeVC20Request) returns (MakeVC20Reply) {}
    rpc JWKS (Empty) returns (JwksReply) {}
}

message MakeSDJWTRequest {
    string scope = 1;
    bytes documentData = 2;
    jwk jwk =3;
}

message MakeSDJWTReply {
   repeated Credential credentials = 1;
   int64 token_status_list_section = 2; // Token Status List section
   int64 token_status_list_index = 3;   // Token Status List index
}

// MakeMDocRequest is the request for creating an mDL document (ISO 18013-5)
message MakeMDocRequest {
    string scope = 1;            // Credential scope (e.g., "pid_1_8", "ehic")
    string doc_type = 2;         // Document type (e.g., "org.iso.18013.5.1.mDL")
    bytes document_data = 3;     // JSON encoded mDL data
    bytes device_public_key = 4; // CBOR encoded COSE_Key for holder's device
    string device_key_format = 5; // Format: "cose", "jwk", or "x509" (default: "cose")
}

// MakeMDocReply contains the issued mDL credential
message MakeMDocReply {
    bytes mdoc = 1;              // CBOR encoded mDoc Document
    int64 status_list_section = 2; // Token Status List section (if revocation enabled)
    int64 status_list_index = 3;   // Token Status List index
    string valid_from = 4;         // RFC3339 timestamp
    string valid_until = 5;        // RFC3339 timestamp
}

message Credential {
   string credential = 1;
}

message Empty {
}

message JwksReply {
    string issuer = 1;
    keys jwks = 2;
}

message keys {
    repeated jwk keys = 1;
}

message jwk {
    string kid = 1;
    string crv = 2;
    string kty = 3;
    string x = 4;
    string y = 5;
    string d = 6;
    repeated string key_ops = 7;
    bool ext = 8;
}

// MakeVC20Request is the request for creating a W3C VC 2.0 Data Integrity credential
message MakeVC20Request {
    string scope = 1;                     // Credential scope (e.g., "pid", "ehic")
    bytes document_data = 2;              // JSON encoded credential subject data
    repeated string credential_types = 3; // Credential types (e.g., ["VerifiableCredential", "PersonIdentificationData"])
    string subject_did = 4;               // Optional subject DID for holder binding
    string cryptosuite = 5;               // Cryptosuite: "ecdsa-rdfc-2019", "ecdsa-sd-2023", or "eddsa-rdfc-2022"
    repeated string mandatory_pointers = 6; // JSON pointers for mandatory claims (SD-2023 only)
}

// MakeVC20Reply contains the issued W3C VC 2.0 credential
message MakeVC20Reply {
    bytes credential = 1;              // JSON-LD encoded credential with Data Integrity proof
    string credential_id = 2;          // The credential's unique ID (urn:uuid:...)
    int64 status_list_section = 3;     // Status list section (if revocation enabled)
    int64 status_list_index = 4;       // Status list index
    string valid_from = 5;             // RFC3339 timestamp
    string valid_until = 6;            // RFC3339 timestamp (optional)
}