---
common:
  mongo:
    uri: mongodb://mongo:27017
  production: false
  tracing:
    addr: jaeger:4318
    type: jaeger
    #timeout: 10
  credential_offer:
    wallet_url: ""
    issuer_url: "http://issuer.vc.docker:8080"
    type: "credential_offer"
    qr:
      recovery_level: 2
      size: 256

credential_constructor:
  pid_1_5:
    vctm_file_path: "/metadata/vctm_pid_arf_1_5.json"
    auth_method: basic
    vct: "urn:eudi:pid:arf-1.5:1"
  pid_1_8:
    vctm_file_path: "/metadata/vctm_pid_arf_1_8.json"
    auth_method: basic
    vct: "urn:eudi:pid:arf-1.8:1"
  ehic:
    vct: "urn:eudi:ehic:1"
    vctm_file_path: "/metadata/vctm_ehic.json"
    auth_method: pid_auth
  pda1:
    vct: "urn:eudi:pda1:1"
    vctm_file_path: "/metadata/vctm_pda1.json"
    auth_method: pid_auth
  elm:
    vct: "urn:eudi:elm:1"
    vctm_file_path: "/metadata/vctm_elm.json"
    auth_method: pid_auth
  diploma:
    vct: "urn:eudi:diploma:1"
    vctm_file_path: "/metadata/vctm_diploma.json"
    auth_method: pid_auth
  micro_credential:
    vct: "urn:eudi:micro_credential:1"
    vctm_file_path: "/metadata/vctm_microcredential.json"
    auth_method: pid_auth
  openbadge_complete:
    vct: "urn:eudi:openbadge_complete:1"
    vctm_file_path: "/metadata/vctm_elm.json"
    auth_method: pid_auth
  openbadge_basic:
    vct: "urn:eudi:openbadge_basic:1"
    vctm_file_path: "/metadata/vctm_elm.json"
    auth_method: pid_auth
  openbadge_endorsements:
    vct: "urn:eudi:openbadge_endorsements:1"
    vctm_file_path: "/metadata/vctm_elm.json"
    auth_method: pid_auth

kafka:
  enabled: false
  brokers:
    - "kafka0:9092"
    - "kafka1:9092"

authentic_sources:
  SUNET_v1:
    country_code: "SE"
    notification_endpoint:
      url: "http://apigw.vc.docker:8080/api/v1/document/notify"
    authentic_source_endpoint:
      url: "http://apigw.vc.docker:8080"
    signature_service_endpoint:
      url: "http://issuer.vc.docker:8080"
    revocation_service_endpoint:
      url: "http://apigw.vc.docker:8080/api/v1/document/revok"
    credential_types:
      EHIC:
        profile: "SD-JWT"
      PDA1:
        profile: "SD-JWT"
  SUNET_v2:
    country_code: "SE"
    notification_endpoint:
      url: "http://apigw.vc.docker:8080/api/v1/document/notify"
    authentic_source_endpoint:
      url: "http://mockas.vc.docker:8080"
    signature_service_endpoint:
      url: "http://issuer.vc.docker:8080"
    revocation_service_endpoint:
      url: "http://apigw.vc.docker:8080/api/v1/document/revok"
    datastore_service_endpoint:
      url: "http://apigw.vc.docker:8080"
    credential_types:
      EHIC:
        profile: "SD-JWT"
      PDA1:
        profile: "SD-JWT"

issuer:
  identifier: "SUNET_v1"
  api_server:
    addr: :8080
  grpc_server:
    addr: issuer.vc.docker:8090
  registry_client:
    addr: registry.vc.docker:8090
  signing_key_path: "/pki/signing_ec_private.pem"
  #pkcs11:
  #  module_path: /usr/lib/softhsm/libsofthsm2.so
  #  slot_id: 0
  #  pin: "1234"
  #  key_label: "issuer-key"
  #  key_id: "issuer-key-1"
  issuer_url: "http://apigw.vc.docker:8080"
  wallet_url: ""
  jwt_attribute:
    issuer: https://issuer.sunet.se
    enable_not_before: true
    valid_duration: 3600
    verifiable_credential_type: "https://credential.sunet.se/identity_credential"
    static_host: "http://vc_dev_portal:8080/statics"

verifier:
  api_server:
    addr: :8080
    external_port: :8080
  grpc_server:
    addr: verifier.vc.docker:8090
  #Replace fqdn with same as in x5c_san_dns cert (used to build web-links etc. example: "vcverifier.sunet.se") - ip is only used when working in local dev env.
  external_server_url: "http://verifier.vc.docker:8080"
  supported_wallets:
    "SUNET dev": "https://dev.wallet.sunet.se/cb"
  oauth_server:
    token_endpoint: "http://verifier.vc.docker:8080/token"
    metadata:
      path: /metadata/oauth2_metadata.json
      signing_key_path: "/pki/signing_ec_private.pem"
      signing_chain_path: "/pki/signing_ec_chain.pem"
    clients:
      "1003":
        type: "confidential"
        redirect_uri: "https://dev.wallet.sunet.se"
        scopes:
          - "pid"
          - "diploma"
          - "ehic"
          - "pda1"
          - "elm"

verifier_proxy:
  api_server:
    addr: :8080
    tls:
      enabled: false
  external_url: "http://verifier_proxy.vc.docker:8080"
  oidc:
    # OIDC Provider identifier (issuer of ID tokens and access tokens)
    # This identifies the verifier-proxy as an OpenID Provider
    # NOT related to verifiable credential issuance (see cmd/issuer/)
    # Must match the 'iss' claim in ID tokens sent to relying parties
    issuer: "http://verifier_proxy.vc.docker:8080"
    signing_key_path: "/pki/signing_rsa_private.pem"
    signing_alg: "RS256"                 # Signing algorithm for ID tokens (RS256, RS384, RS512, ES256, ES384, ES512)
    session_duration: 900                # Session duration in seconds (15 minutes)
    code_duration: 600                   # Authorization code duration in seconds (10 minutes)
    access_token_duration: 3600          # Access token duration in seconds (1 hour)
    id_token_duration: 3600              # ID token duration in seconds (1 hour)
    refresh_token_duration: 86400        # Refresh token duration in seconds (24 hours)
    subject_type: "pairwise"
    subject_salt: "change-this-in-production"
  openid4vp:
    presentation_timeout: 300
    # Template-based presentation requests (optional)
    # When configured, DCQL queries are loaded from YAML templates
    # Falls back to supported_credentials if templates not found or disabled
    presentation_requests_dir: "/presentation_requests"
    supported_credentials:
      - vct: "urn:eudi:pid:1"
        scopes:
          - "profile"
          - "pid"
      - vct: "urn:eudi:ehic:1"
        scopes:
          - "ehic"
      - vct: "urn:eudi:pda1:1"
        scopes:
          - "pda1"
      - vct: "urn:eudi:elm:1"
        scopes:
          - "elm"
      - vct: "urn:eudi:diploma:1"
        scopes:
          - "diploma"

registry:
  api_server:
    addr: :8080
  external_server_url: "http://localhost:8080"
  grpc_server:
    addr: :8090
    # mTLS configuration (optional)
    # tls:
    #   enabled: true
    #   cert_file_path: "/pki/grpc_server.crt"
    #   key_file_path: "/pki/grpc_server.key"
    #   client_ca_path: "/pki/client_ca.crt"  # For mutual TLS
  # Token Status Lists configuration per draft-ietf-oauth-status-list
  token_status_lists:
    signing_key_path: "/pki/signing_ec_private.pem"
  # Admin GUI configuration (optional)
  admin_gui:
    enabled: true
    username: "admin"
    password: "admin_1234"  # Change this in production!
    session_secret: "change-this-to-a-random-32-byte-secret"

persistent:
  api_server:
    addr: :8080

apigw:
  identifier: "SUNET_v1"
  api_server:
    addr: :8080
    basic_auth:
    enabled: false
    users:
      admin: "secret123"
  external_server_url: "http://apigw.vc.docker:8080"
  issuer_client:
    addr: issuer.vc.docker:8090
  registry_client:
    addr: registry.vc.docker:8090
  credential_offers:
    issuer_url: http://apigw.vc.docker:8080
    wallets:
      sunet_dev: 
        label: SUNET Dev Wallet
        redirect_uri: https://dev.wallet.sunet.se/cb
      funke: 
        label: Funke Wallet
        redirect_uri: https://funke.wwwallet.org/cb
      dc4eu: 
        label: DC4EU Wallet
        redirect_uri: https://dc4eu.wwwallet.org/cb
      vanilla: 
        label: Vanilla wwWallet
        redirect_uri: https://demo.wwwallet.org/cb
      siros_sunet:
        label: Siros SUNET Wallet
        redirect_uri: https://sunetwallet-dev.app.siros.org/cb
  trust_model:
    type: "openid_federation"
    trust_anchors:
      - "https://example.com/trust_anchor.pem"
  oauth_server:
    token_endpoint: "http://apigw.vc.docker:8080/token"
    metadata:
      path: /metadata/oauth2_metadata.json
      signing_key_path: "/pki/signing_ec_private.pem"
      signing_chain_path: "/pki/signing_ec_chain.pem"
    clients:
      "1003":
        type: "confidential"
        redirect_uri: "https://dev.wallet.sunet.se"
        scopes:
          - "pid"
          - "diploma"
          - "ehic"
          - "pda1"
          - "elm"
  issuer_metadata:
    path: "/metadata/issuer_metadata.json"
    signing_key_path: "/pki/signing_ec_private.pem"
    signing_chain_path: "/pki/signing_ec_chain.pem"
  # OIDC Relying Party configuration for issuing credentials via external OIDC Providers
  # Requires building with -tags oidcrp
  oidcrp:
    enabled: false
    # OAuth2 client credentials registered with the OIDC Provider
    client_id: "your-client-id"
    client_secret: "your-client-secret"
    # Callback URL where the OIDC Provider sends the authorization response
    redirect_uri: "https://issuer.example.com/oidcrp/callback"
    # OIDC Provider issuer URL (used for .well-known/openid-configuration discovery)
    # Examples:
    #   Google: "https://accounts.google.com"
    #   Azure AD: "https://login.microsoftonline.com/{tenant-id}/v2.0"
    #   Keycloak: "https://keycloak.example.com/realms/{realm-name}"
    issuer_url: "https://accounts.google.com"
    # OAuth2/OIDC scopes to request (must include "openid")
    scopes:
      - "openid"
      - "profile"
      - "email"
    # Session duration in seconds (default: 3600)
    session_duration: 3600
    # Credential mappings: how to transform OIDC claims into credentials
    # Key: credential type identifier (must match credential_constructor keys)
    credential_mappings:
      pid:
        # OpenID4VCI credential configuration ID
        credential_config_id: "urn:eudi:pid:1"
        # Attribute mappings: OIDC claim name -> credential claim path
        # Supports dot-notation for nested structures (e.g., "identity.given_name")
        attributes:
          # Standard OpenID Connect claims
          given_name:
            claim: "identity.given_name"
            required: true
          family_name:
            claim: "identity.family_name"
            required: true
          email:
            claim: "identity.email"
            required: true
          email_verified:
            claim: "identity.email_verified"
            required: false
          # Subject identifier
          sub:
            claim: "identity.subject_id"
            required: true
            transform: "lowercase"
          # Optional claims with defaults
          locale:
            claim: "identity.locale"
            required: false
            default: "en-US"
      # Example: diploma credential from university OIDC provider
      diploma:
        credential_config_id: "urn:eudi:diploma:1"
        attributes:
          given_name:
            claim: "student.given_name"
            required: true
          family_name:
            claim: "student.family_name"
            required: true
          email:
            claim: "student.email"
            required: true
          # Custom claims from the OIDC provider
          student_id:
            claim: "student.id"
            required: true
          degree:
            claim: "diploma.degree"
            required: true
          graduation_date:
            claim: "diploma.graduation_date"
            required: true
          university:
            claim: "diploma.university"
            required: false
            default: "Unknown University"
  
  # Alternative: Dynamic Client Registration (RFC 7591)
  # Uncomment to enable automatic client registration with OIDC Providers
  # oidcrp:
  #   enabled: true
  #   # Static credentials are optional when using dynamic registration
  #   # client_id: "optional-fallback-id"
  #   # client_secret: "optional-fallback-secret"
  #   redirect_uri: "https://issuer.example.com/oidcrp/callback"
  #   issuer_url: "https://accounts.google.com"
  #   scopes:
  #     - "openid"
  #     - "profile"
  #     - "email"
  #   session_duration: 3600
  #   # Client metadata for dynamic registration
  #   client_name: "My Credential Issuer"
  #   client_uri: "https://issuer.example.com"
  #   logo_uri: "https://issuer.example.com/logo.png"
  #   contacts:
  #     - "admin@example.com"
  #   tos_uri: "https://issuer.example.com/terms"
  #   policy_uri: "https://issuer.example.com/privacy"
  #   # Dynamic registration settings
  #   dynamic_registration:
  #     enabled: true
  #     # Some providers (e.g., Keycloak) require an initial access token
  #     # Generate in Keycloak: Realm Settings → Client Registration → Initial Access Tokens
  #     initial_access_token: ""  # Optional, leave empty for Google
  #     # Cache registered credentials to avoid re-registration on restart
  #     storage_path: "/var/lib/vc/oidcrp_credentials.json"
  #   credential_mappings:
  #     pid:
  #       credential_config_id: "urn:eudi:pid:1"
  #       attributes:
  #         given_name:
  #           claim: "identity.given_name"
  #           required: true
  #         family_name:
  #           claim: "identity.family_name"
  #           required: true
  #         email:
  #           claim: "identity.email"
  #           required: true

mock_as:
  api_server:
    addr: :8080
  bootstrap_users:
    - "100"
    - "102"
  datastore_url: http://apigw.vc.docker:8080

ui:
  api_server:
    addr: :8080
  username: "admin"
  password: "secret123"
  #It is recommended to use an authentication key with 32 or 64 bytes.
  session_cookie_authentication_key: "PjanW5cOBIlWzjLK23Q8NIo4va53e1bsgWmcqMdznVzkW3uEozfotj7MZsD7HpBo"
  #The encryption key, must be either 16, 24, or 32 bytes to select AES-128, AES-192, or AES-256 modes.
  session_store_encryption_key: "SQxqb3LKw1YFyAiy4j7FaGGJKeEzr8Db"
  session_inactivity_timeout_in_seconds: 1800
  services:
    apigw:
      base_url: http://apigw.vc.docker:8080
    mockas:
      base_url: http://mockas.vc.docker:8080
    verifier:
      base_url: http://verifier.vc.docker:8080
